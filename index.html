<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avoid Falling Emoji Objects üéÆ‚ú®</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #404040; /* Dark Grey Background */
            color: white;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        canvas {
            border: 1px solid #fff;
        }

        .menu, .start-screen, .changelog, .admin-menu {
            text-align: center;
            position: absolute;
        }

        .button {
            background-color: #555;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
        }

        .button:hover {
            background-color: #777;
        }

        .scoreboard {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 18px;
        }

        .credits {
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-size: 14px;
            color: #aaa;
        }

        #helpMenu, #changelogMenu, #adminMenu, #scoreboardMenu {
            display: none;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            color: white;
        }

        .input-field {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            border: none;
            background: white;
            color: black;
            font-size: 16px;
        }

        .emoji {
            font-size: 30px;
        }

        .score-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
        }

        .top-score {
            font-size: 20px;
        }
    </style>
</head>
<body>

    <div class="start-screen">
        <h1>Welcome to Emoji Dodge Game! üéÆ‚ú®</h1>
        <button class="button" onclick="startGame()">Start Game</button>
        <button class="button" onclick="showChangelog()">Changelog</button>
        <button class="button" onclick="showScoreboard()">Scoreboard</button>
        <button class="button" onclick="showAdminMenu()">Admin Menu</button>
    </div>

    <div id="changelogMenu">
        <h2>Changelog üìú</h2>
        <ul id="changelogList"></ul>
        <button class="button" onclick="closeChangelog()">Close</button>
        <button class="button" onclick="backToMainMenu()">Back to Main Menu</button>
    </div>

    <div id="adminMenu">
        <h2>Admin Menu - Enter Password üîê</h2>
        <input type="password" id="adminPassword" class="input-field" placeholder="Enter Admin Password">
        <button class="button" onclick="checkPassword()">Submit</button>
        <p id="adminError" style="color: red;"></p>
        <div id="adminActions" style="display: none;">
            <h3>Game Adjustments</h3>
            <label>Speed of Falling Objects:</label>
            <input type="number" id="fallingSpeed" class="input-field" placeholder="Speed (1-10)" min="1" max="10">
            <button class="button" onclick="applyGameSettings()">Apply Settings</button>
            <h3>Changelog Management</h3>
            <textarea id="newChangelogMessage" class="input-field" placeholder="Add new changelog message"></textarea>
            <button class="button" onclick="addChangelogMessage()">Add Changelog</button>
            <button class="button" onclick="deleteChangelogMessages()">Delete All Changelog Messages</button>
            <h3>Reset Scoreboard</h3>
            <button class="button" onclick="resetScoreboard()">Reset Scoreboard</button>
        </div>
        <button class="button" onclick="backToMainMenu()">Back to Main Menu</button>
    </div>

    <div id="scoreboardMenu">
        <h2>Scoreboard üèÜ</h2>
        <ul id="scoreList"></ul>
        <button class="button" onclick="closeScoreboard()">Close</button>
        <button class="button" onclick="backToMainMenu()">Back to Main Menu</button>
    </div>

    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <div class="scoreboard">
        Score: <span id="score">0</span> | Top Score: <span id="topScore">0</span>
    </div>

    <div class="credits">Made by Nisse_S üíª</div>

    <script>
        // Game Variables
        let canvas = document.getElementById('gameCanvas');
        let ctx = canvas.getContext('2d');
        let player;
        let fallingObjects = [];
        let score = 0;
        let topScore = localStorage.getItem('topScore') || 0;
        let gameInterval;
        let objectInterval;
        let isGameRunning = false;
        let emojiOptions = ["üçé", "üçå", "üçâ", "üçç", "üçì", "üçã"];
        let selectedEmoji = emojiOptions[0]; // Default emoji
        let fallingSpeed = 2; // Default falling speed
        let highScores = JSON.parse(localStorage.getItem('highScores')) || [];
        let changelogMessages = JSON.parse(localStorage.getItem('changelogMessages')) || [];

        // Player object (now using emoji)
        function Player() {
            this.x = canvas.width / 2;
            this.y = canvas.height - 30;
            this.width = 30; // Smaller hitbox
            this.height = 30; // Smaller hitbox
            this.speed = 5;
            this.emoji = "üßë"; // Emoji for player

            this.draw = function() {
                ctx.font = "30px Arial";
                ctx.fillText(this.emoji, this.x, this.y);
            };

            this.move = function(direction) {
                if (direction === 'left' && this.x > 0) {
                    this.x -= this.speed;
                }
                if (direction === 'right' && this.x < canvas.width - this.width) {
                    this.x += this.speed;
                }
            };
        }

        // Falling object class with emoji
        function FallingObject() {
            this.x = Math.random() * canvas.width;
            this.y = 0;
            this.size = 30;
            this.speed = Math.random() * fallingSpeed + 1;
            this.type = Math.random() < 0.8 ? "bomb" : "star"; // 80% chance of bomb
            this.emoji = this.type === "bomb" ? "üí£" : "‚≠ê"; // Bomb or Star emoji
            this.points = this.type === "bomb" ? -1 : 50; // Bomb kills the player, star gives 50 points

            this.update = function() {
                this.y += this.speed;
            };

            this.draw = function() {
                ctx.font = "30px Arial";
                ctx.fillText(this.emoji, this.x, this.y);
            };
        }

        // Game Functions
        function startGame() {
            const playerName = prompt("Please enter your name for the scoreboard:");

            if (playerName) {
                localStorage.setItem('playerName', playerName);

                score = 0;
                document.getElementById('score').innerText = score;
                document.getElementById('topScore').innerText = topScore;
                isGameRunning = true;
                player = new Player();
                fallingObjects = [];
                gameInterval = setInterval(gameLoop, 1000 / 60);
                objectInterval = setInterval(createFallingObject, 1000);
                setInterval(increaseScore, 1000);
                document.querySelector(".start-screen").style.display = "none"; // Hide start screen
            } else {
                alert("Game cancelled.");
            }
        }

        function gameLoop() {
            if (!isGameRunning) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Update falling objects
            fallingObjects.forEach((object, index) => {
                object.update();
                object.draw();
                if (object.y > canvas.height) {
                    fallingObjects.splice(index, 1);
                }

                // Check for collision with player
                if (object.y + object.size >= player.y && object.x < player.x + player.width && object.x + object.size > player.x) {
                    if (object.type === "bomb") {
                        gameOver();
                    } else {
                        score += object.points;
                        document.getElementById('score').innerText = score;
                    }
                    fallingObjects.splice(index, 1);
                }
            });

            player.draw();
        }

        function createFallingObject() {
            fallingObjects.push(new FallingObject());
        }

        function increaseScore() {
            score += 1;
            document.getElementById('score').innerText = score;
        }

        function gameOver() {
            if (score > topScore) {
                topScore = score;
                localStorage.setItem('topScore', topScore);
            }

            // Save the score in localStorage (Highscore system)
            if (highScores.length < 5) {
                highScores.push({ name: localStorage.getItem('playerName'), score });
            } else {
                highScores.push({ name: localStorage.getItem('playerName'), score });
                highScores.sort((a, b) => b.score - a.score);
                highScores = highScores.slice(0, 5);
            }

            localStorage.setItem('highScores', JSON.stringify(highScores));
            clearInterval(gameInterval);
            clearInterval(objectInterval);
            isGameRunning = false;
            document.getElementById('topScore').innerText = topScore;
            showScoreboard();
        }

        // Display the Scoreboard
        function showScoreboard() {
            let scoreList = document.getElementById('scoreList');
            scoreList.innerHTML = '';
            highScores.forEach((entry, index) => {
                let scoreItem = document.createElement('li');
                scoreItem.innerText = `${index + 1}. ${entry.name}: ${entry.score}`;
                scoreList.appendChild(scoreItem);
            });
            document.getElementById('scoreboardMenu').style.display = 'block';
        }

        function closeScoreboard() {
            document.getElementById('scoreboardMenu').style.display = 'none';
        }

        function backToMainMenu() {
            clearInterval(gameInterval);
            clearInterval(objectInterval);
            document.querySelector(".start-screen").style.display = "block"; // Show start screen
            document.getElementById('scoreboardMenu').style.display = 'none';
        }

        // Admin Menu
        function showAdminMenu() {
            document.getElementById('adminMenu').style.display = 'block';
        }

        function closeAdminMenu() {
            document.getElementById('adminMenu').style.display = 'none';
        }

        function checkPassword() {
            let password = document.getElementById('adminPassword').value;
            if (password === 'admin123') {
                document.getElementById('adminActions').style.display = 'block';
                document.getElementById('adminError').style.display = 'none';
            } else {
                document.getElementById('adminError').style.display = 'block';
                document.getElementById('adminError').innerText = 'Incorrect Password!';
            }
        }

        function resetScoreboard() {
            if (confirm("Are you sure you want to reset the scoreboard?")) {
                localStorage.removeItem('highScores');
                highScores = [];
                alert("Scoreboard has been reset.");
                showScoreboard();
            }
        }

        function applyGameSettings() {
            let newSpeed = document.getElementById('fallingSpeed').value;
            if (newSpeed >= 1 && newSpeed <= 10) {
                fallingSpeed = newSpeed;
                alert("Game settings updated.");
            } else {
                alert("Speed should be between 1 and 10.");
            }
        }

        function addChangelogMessage() {
            let newMessage = document.getElementById('newChangelogMessage').value;
            if (newMessage) {
                changelogMessages.push(newMessage);
                localStorage.setItem('changelogMessages', JSON.stringify(changelogMessages));
                showChangelog();
            } else {
                alert("Please enter a message.");
            }
        }

        function deleteChangelogMessages() {
            changelogMessages = [];
            localStorage.setItem('changelogMessages', JSON.stringify(changelogMessages));
            showChangelog();
        }

        function showChangelog() {
            let changelogList = document.getElementById('changelogList');
            changelogList.innerHTML = '';
            changelogMessages.forEach((message) => {
                let changelogItem = document.createElement('li');
                changelogItem.innerText = message;
                changelogList.appendChild(changelogItem);
            });
            document.getElementById('changelogMenu').style.display = 'block';
        }

        function closeChangelog() {
            document.getElementById('changelogMenu').style.display = 'none';
        }
    </script>

</body>
</html>
